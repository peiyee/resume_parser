<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
	<title>Resume Parser</title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mithril/0.2.3/mithril.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/application.css">
</head>
<body>
	<h1>resume</h1>
  <span>
    <div>teh</div>
    <div>pei</div>
  </span>
<!-- <form enctype="multipart/form-data" method="post">
  <fieldset>
    <legend>Upload Your Resume</legend>
     <input type="file" id="upload_file" accept=".json"></input>
     <input type="button" id="load_file" value="load"></input>
  </fieldset>
</form> -->
<div id="resume-table">
 
</div>
<script type="text/javascript">

function createElement(name){
 return function(){
  return m.apply(null,[name,...arguments])
 }
};
function createElementWithClass(name,klass){
 return function(){
  console.log(name)
  console.log(arguments)
 
  return m.apply(null,[name,klass,...arguments])
 }
};
var tr = createElement('tr')
var td = createElement('td')
var div = createElement('div')
var hr = createElement('hr')
var divTitle = createElementWithClass('div',{class:"title"})
var h2NoMargin = createElementWithClass('h2',{class:"title"})
Table={
  controller:function(){
  var ctrl = {};

  ctrl.resume = null;
  
  ctrl.onclick = function(){
    var file, fr,resume;
    if (typeof window.FileReader !== 'function') {
      alert("The file API isn't supported on this browser yet.");
      return;
    }
    
    file = document.getElementById("upload_file").files[0];
    fr = new FileReader();
    fr.onload = receivedText;
    fr.readAsText(file);

    console.log(file,fr);
      
    function receivedText(e) {
      m.startComputation();

      lines = e.target.result;
      resume = JSON.parse(lines);
      
      ctrl.resume = resume;

      m.endComputation();
    }
  };

  return ctrl;


  },
  view:function(ctrl){
    var resume = ctrl.resume;
    console.log(Boolean(resume))
    if (resume)
      return m('div', form(),table());
    return m('div', form());

    function form(){
      return m('form', {enctype:"multipart/form-data", method:"post"},
        m('fieldset', [
          m('legend', 'Upload Your Resume'),
          m('input', {type:'file', accept:'.json', id: 'upload_file'}),
          m('input', {type:'button', value: 'load', onclick: ctrl.onclick}),
        ])
      )
    }

    function table(){

      return [
      div(
        h2NoMargin('Contact Info'),
        hr(),
        div('Name:'),
        div(resume.contact_info.name)),
     
      div(
        h2NoMargin('Summary'),
        hr(),
        div(resume.summary)),
      
      div(
        h2NoMargin('Working Experience'),
        hr(),
        resume.experience ? resume.experience.map(experienceRow) : ""),
      
      div(
        h2NoMargin('Education'),
        hr(),
        resume.education ? resume.education.map(educationRow) : ""),
      
      div(
        h2NoMargin('Additional Skill'),
        hr(),
        resume.additional_skill.map(additionalSkillRow))
      ];
      // return m('table',
      //   tr(td('Contact Info')),
      //   tr(td("Name: "),td([resume.contact_info.name])),
      //   tr(td('Phone: '),td([resume.contact_info.phone])),
      //   tr(td('Email: '),td([resume.contact_info.email])),
      //   tr(td('Address: '),td(formatAddress(resume.contact_info.address))),
      //   tr(td('Github Account: '),td([resume.contact_info.github])),
      //   tr(td('LinkedIn Account: '),td([resume.contact_info.linkedIn])),
      //   tr(td('Summary')),
      //   tr(td({colspan:"2"},resume.summary)),
      //   tr(td('Experience')),
      //   resume.experience ? resume.experience.map(experienceRow) : "",
      //   tr('Education'),
      //   resume.education ? resume.education.map(educationRow) : "",
      //   tr('Additional Skill'),
      //   resume.additional_skill ? resume.additional_skill.map(additionalSkillRow) : ""
      //   );
    }
    function additionalSkillRow(entry,index){
      return div(entry)
    }
    function experienceRow(entry,index){
       return [
                div('Title:'),
                div(entry.title),
                div('Company:'),
                div(entry.company),
                div('Start Date:'),
                div(entry.start_date),
                div('End Date:'),
                div(entry.end_date)
              ]
      }
    function educationRow(entry,index){
      return [
              div('School:'),
              div(entry.title),
              div('GPA:'),
              div(entry.company),
              div('Start Date:'),
              div(entry.start_date),
              div('End Date:'),
              div(entry.end_date),
              div('Major:'),
              div(entry.major)
            ]
    }
   
    function formatAddress(address){
      return address.street + ' ' + address.postcode + ' ' + address.city + ' ' + address.state + ' ' + address.country
    }
  }
}

m.mount(document.getElementById('resume-table'),Table);
</script>
</body>
</html>

